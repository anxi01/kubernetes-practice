# 쿠버네티스의 구조

## 쿠버네티스 클러스터

쿠버네티스 클러스터는 마스터 노드(Master Node)와 워커 노드(Worker Node)로 구분된다.
개발자는 마스터 노드와 통신하고, 사용자는 인터넷을 통해 워커 노드와 통신한다.

<img src="https://www.opsramp.com/wp-content/uploads/2022/07/Kubernetes-Architecture-1024x648.png">

> ✅ 마스터 노드와 워커 노드 간 유기적인 통신이 중요
>
> ✅ CNI (Container Network Interface) 를 통해 컨테이너 간 통신이 이루어짐

## 마스터용 컴포넌트 (컨트롤 플레인)

> 쿠버네티스 클러스터 전반의 작업을 관리한다.

<img src="https://github.com/user-attachments/assets/e99256ce-0ebf-4328-ba84-1b7cba2f438b">

| 구성 요소                       | 설명                                                                                    |
|-----------------------------|---------------------------------------------------------------------------------------|
| **kube-apiserver**          | - 쿠버네티스 클러스터의 API를 사용할 수 있도록 하는 컴포넌트 <br/> - 쿠버네티스에 보내는 모든 요청을 API 서버를 통해 다른 컴포넌트로 전달 |
| **etcd**                    | 쿠버네티스에 필요한 모든 데이터를 저장하는 Key-Value 저장소                                                 |
| **kube-scheduler**          | 현재 클러스터 안에서 자원 할당이 가능한 노드 중 알맞은 노드를 선택해 새롭게 만든 파드를 실행                                 |
| **kube-controller-manager** | 파드들을 관리하는 **컨트롤러** 각각을 실행하는 컴포넌트                                                      |

---

## 노드용 컴포넌트

> 쿠버네티스 실행 환경을 관리한다.

### Kubelet

- 파드 내부의 **컨테이너 실행**을 담당
- 파드의 상태를 모니터링하고, 상태 이상이 있을 경우 해당 파드를 재배포

### Kube-Proxy

- 노드에서 **네트워크** 역할을 수행
- 노드에 존재하는 파드들이 쿠버네티스 내부/외부와 네트워크 통신을 가능하게 한다.

### 컨테이너 런타임

- 실제로 컨테이너를 실행시킨다.
- **컨테이너 생명주기**를 담당
- Kubelet은 컨테이너 런타임과 통신하는데, 이때 CRI(Container Runtime Interface)를 사용한다.
- 보편적으로 'containerd'를 사용

### 파드

- 쿠버네티스에서는 컨테이너가 단독으로 실행되지 않고, 파드(Pod) 내에서 실행한다.
- 파드는 컨테이너를 실행하기 위한 오브젝트로써, 한 개 이상의 컨테이너를 담을 수 있다. (**컨테이너 그룹화**)

> 도커에서는 컨테이너가 최소 단위, 쿠버네티스에서는 파드가 최소 단위

---

## 워크로드

> 쿠버네티스에서 실행되는 애플리케이션

| 리소스             | 설명                        |
|-----------------|---------------------------|
| **ReplicaSet**  | 파드의 복제 및 스케일링 관리          |
| **Deployment**  | 애플리케이션 배포 및 롤링 업데이트, 스케일링 |
| **StatefulSet** | 파드의 순서, 고유성, 안정성을 보장      |
| **DaemonSet**   | 클러스터 모든 노드에서 파드 실행        |
| **Job**         | 1회성 작업 수행 후 종료            |
| **CronJob**     | 스케줄에 따라 반복 작업 수행          |

---

## 네트워크

### 서비스

- 서비스를 사용하면 파드를 여러 개 묶어서 클러스터 외부로 노출시킬 수 있다.
- 장점 : 이미 실행 중인 파드를 외부로 노출시키기 위해 파드 내부를 수정할 필요 ❌

### 인그레스

- 쿠버네티스 내부 서비스를 HTTP/HTTPS 루트를 클러스터 외부로 라우팅
